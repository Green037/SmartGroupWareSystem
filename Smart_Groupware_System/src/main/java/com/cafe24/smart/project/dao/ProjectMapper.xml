<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
	
<mapper namespace="PrDAO">
	<resultMap id="resultPr" type="com.cafe24.smart.project.domain.Project">
		<result property="prCode" column="pr_code"/>
		<result property="prMemberCode" column="pr_memberCode"/>
		<result property="dftCode" column="dft_code"/>
		<result property="prName" column="pr_name"/>
		<result property="prMember" column="pr_member"/>
		<result property="prMoney" column="pr_money"/>
		<result property="prGoal" column="pr_goal"/>
		<result property="prProgress" column="pr_progress"/>
		<result property="prCate" column="pr_cate"/>
		<result property="prRestration" column="pr_resitration"/>
		<result property="prStartDay" column="pr_startDay"/>
		<result property="prEndDay" column="pr_endDay"/>
		<result property="prForProgress" column="pr_forProgress"/>
		<result property="prFinishCheck" column="pr_finishCheck"/>
	</resultMap>
	
	<resultMap type="com.cafe24.smart.project.domain.ProjectMember" id="resultPm">
		<result property="pmCode" column="pm_code"/>
		<result property="prCode" column="pr_code"/>
		<result property="mmCode" column="mm_code"/>
		<result property="pmLevel" column="pm_level"/>
		<result property="pmField" column="pm_field"/>
		<result property="pmStartDate" column="pm_startDate"/>
		<result property="pmEndDate" column="pm_endDate"/>
		<result property="pmNote" column="pm_note"/>
		<result property="pmApproval" column="pm_approval"/>
		<result property="mmName" column="mm_name"/>
	</resultMap>
	
	<resultMap type="com.cafe24.smart.project.domain.Funds" id="resultFu">
		<result property="fuCode" column="fu_code"/>
		<result property="prCode" column="pr_code"/>
		<result property="fuHistory" column="fu_history"/>
		<result property="fuExpectedMoney" column="fu_expectedMoney"/>
		<result property="fuUsedMoney" column="fu_usedMoney"/>
		<result property="fuAddReason" column="fu_addReason"/>
		<result property="fuDraftCheck" column="fu_draftCheck"/>
		<result property="fuAddMoney" column="fu_addMoney"/>
	</resultMap>
	<resultMap id="resulWbs" type="com.cafe24.smart.wbs.domain.Wbs">
		<result property="wbsCode" column="wbs_code"/>
		<result property="prCode" column="pr_code"/>
		<result property="wbsCate" column="wbs_cate"/>
		<result property="wbsName" column="wbs_name"/>
		<result property="wbsContents" column="wbs_contents"/>
		<result property="wbsStartDate" column="wbs_startDate"/>
		<result property="wbsEndDate" column="wbs_endDate"/>
		<result property="wbsWorkingDays" column="wbs_workingDays"/>
		<result property="wbsUncompletedReason" column="wbs_uncompletedReason"/>
		<result property="wbsFinalEndDate" column="wbs_finalEndDate"/>
	</resultMap>
	<resultMap id="resultMm" type="com.cafe24.smart.member.domain.Member">
		<result property="mmCode" column="mm_code"/>
		<result property="ctCode" column="ct_code"/>
		<result property="ptCode" column="pt_code"/>
		<result property="dpCode" column="dp_code"/>
		<result property="mmName" column="mm_name"/>
		<result property="mmDailyPay" column="mm_dailyPay"/>
		<result property="mmJoinDate" column="mm_joinDate"/>
		<result property="mmResignDate" column="mm_resignDate"/>
		<result property="mmAnnualLeave" column="mm_annualLeave"/>
		<result property="mmArmy" column="mm_army"/>
		<result property="mmEmail" column="mm_email"/>
		<result property="mmMarriage" column="mm_marriage"/>
		<result property="mmPassword" column="mm_password"/>
		<result property="mmSign" column="mm_sign"/>
		<result property="mmAddress" column="mm_address"/>
		<result property="mmTel" column="mm_tel"/>
		<result property="mmBank" column="mm_bank"/>
		<result property="mmAccount" column="mm_account"/>
	</resultMap>
	
	<insert id="insertPr" 
			parameterType="com.cafe24.smart.project.domain.Project" 
			useGeneratedKeys="true" keyProperty="prCode">
		INSERT INTO project(
			pr_memberCode,
			dft_code,
			pr_name,
			pr_member,
			pr_money,
			pr_goal,
			pr_progress,
			pr_cate,
			pr_startDay,
			pr_endDay,
			pr_forProgress,
			pr_restration,
			pr_finishCheck)
		VALUES(
			#{prMemberCode},
			#{dftCode},
			#{prName},
			#{prMember},
			#{prMoney},
			#{prGoal},
			#{prProgress},
			#{prCate},
			#{prStartDay},
			#{prEndDay},
			#{prForProgress},
			now(),
			#{prFinishCheck})
	</insert>
	
	<insert id="insertFu"
			parameterType="com.cafe24.smart.project.domain.Funds">
		INSERT INTO funds(
			pr_code,
			fu_history,
			fu_expectedMoney)
		VALUES(
			#{prCode},
			#{fuHistory},
			#{fuExpectedMoney})
	</insert>
	
	<insert id="insertPm"
			parameterType="com.cafe24.smart.project.domain.ProjectMember">
		INSERT INTO projectMember(
			pr_code,
			mm_code,
			pm_level,
			pm_field,
			pm_startDate,
			pm_note)
		VALUES(
			#{prCode},
			#{mmCode},
			#{pmLevel},
			#{pmField},
			#{pmStartDate},
			#{pmNote})
	</insert>
	
	<select id="selectAll"
			resultMap="resultPr">
		SELECT 
			*
		FROM
			project
	</select>
	
	<select id="selectByProgress"
			parameterType="String"
			resultMap="resultPr">
		SELECT 
			*
		FROM
			project
		WHERE 
			pr_progress = #{progress} 
	</select>
	
	<select id="selectByFinish"
			parameterType="String"
			resultMap="resultPr">
		SELECT 
			*
		FROM
			project
		WHERE 
			pr_finishCheck = #{progress} 
	</select>
	
	<select id="selectByPrCode"
			parameterType="int"
			resultMap="resultPr">
		SELECT 
			*
		FROM
			project
		WHERE 
			pr_code = #{prCode} 
	</select>
	
	<select id="selectByPrCodePm"
			parameterType="int"
			resultMap="resultPm">
		SELECT 
			projectMember.*, 
			memberManagement.mm_name
		FROM
			projectMember
		LEFT JOIN
			memberManagement
		ON 
			projectMember.mm_code = memberManagement.mm_code
		WHERE 
			pr_code = #{prCode} 
	</select>
	
	<select id="selectCountPm"
			parameterType="int"
			resultType="int">
		SELECT 
			COUNT(*)
		FROM
			projectMember
		WHERE
			pr_code = #{prCode}
			AND pm_approval = "승인"
	</select>
	
	<select id="selectByPrCodeFu"
			parameterType="int"
			resultMap="resultFu">
		SELECT 
			*
		FROM
			funds
		WHERE 
			pr_code = #{prCode} 
	</select>
	
	<update id="updatePr"
			parameterType="com.cafe24.smart.project.domain.Project">
		UPDATE project
		SET
			pr_name = #{prName},
			pr_progress = #{prProgress},
			pr_cate = #{prCate},
			pr_forProgress = #{prForProgress},
			pr_money = #{prMoney},
			pr_finishCheck = #{prFinishCheck},
			pr_Goal = #{prGoal}
		WHERE
			pr_code = #{prCode}
	</update>
	
	<update id="updateByApprovalPm"
			parameterType="com.cafe24.smart.project.domain.ProjectMember">
		UPDATE projectMember
		SET
			pm_approval = #{pmApproval},
			pm_startDate = now()
		WHERE
			pm_code = #{pmCode}
	</update>
	
	<select id="selectByFuCode"
			parameterType="int"
			resultMap="resultFu">
		SELECT 
			*
		FROM
			funds
		WHERE 
			fu_code = #{fuCode} 
	</select>
	
	<update id="updateFu"
			parameterType="com.cafe24.smart.project.domain.Funds">
		UPDATE funds
		SET
			fu_history = #{fuHistory},
			fu_expectedMoney = #{fuExpectedMoney},
			fu_usedMoney = #{fuUsedMoney}
		WHERE
			fu_code = #{fuCode}
	</update>
	
	<select id="selectByMmCodeMm"
			parameterType="int"
			resultType="HashMap">
		SELECT 
			memberManagement.mm_name as mmName,
			memberManagement.mm_email as mmEmail,
			memberManagement.mm_tel as mmTel,
			rankposition.pt_name as ptName,
			contract.ct_type as ctType
		FROM 
			memberManagement
		LEFT JOIN 
			rankposition
		ON 
			memberManagement.pt_code = rankposition.pt_code
		LEFT JOIN 
			contract
		ON 
			memberManagement.ct_code = contract.ct_code
		WHERE 
			mm_code = #{mmCode};
	</select>
</mapper>