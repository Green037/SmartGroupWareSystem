<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
	
<mapper namespace="AprDAO">
	<resultMap id="resultApr" type="com.cafe24.smart.approve.domain.Approval">
		<result property="aprCode" column="apr_code"/>
		<result property="mmCode" column="mm_code"/>
		<result property="aprApproval1" column="apr_approval1"/>
		<result property="aprApproval2" column="apr_approval2"/>
		<result property="aprApproval3" column="apr_approval3"/>
	</resultMap>
	
	<resultMap id="resultDoc" type="com.cafe24.smart.approve.domain.Document">
		<result property="docCode" column="doc_code"/>
		<result property="docFileGroup" column="doc_fileGroup"/>
		<result property="docFileName" column="doc_fileName"/>
		<result property="docFileOri" column="doc_fileOri"/>
		<result property="docFilePath" column="doc_filePath"/>
		<result property="docFileExtention" column="doc_fileName"/>
	</resultMap>
		
	<resultMap id="resultDft" type="com.cafe24.smart.approve.domain.Draft">
		<result property="dftCode" column="dft_code"/>
		<result property="aprCode" column="apr_code"/>
		<result property="docCode" column="doc_code"/>
		<result property="mmCode" column="mm_code"/>
		<result property="dftTitle" column="dft_title"/>
		<result property="dftDegree" column="dft_degree"/>
		<result property="dftDate" column="dft_date"/>
		<result property="dftApproval1" column="dft_approval1"/>
		<result property="dftApproval2" column="dft_approval2"/>
		<result property="dftApproval3" column="dft_approval3"/>
		<result property="dftFinalState" column="dft_finalState"/>
		<result property="dftCheck" column="dft_check"/>
		<result property="proApproval" column="pro_approval"/>
		<result property="proRealTime" column="pro_realTime"/>
		<result property="dftFileName" column="dft_fileName"/>
		<result property="dftFilePath" column="dft_filePath"/>
		<result property="dftFileOri" column="dft_fileOri"/>
		<result property="dftFileExtention" column="dft_fileExtention"/>
		<result property="docFileGroup" column="doc_fileGroup"/>

	</resultMap>
	
	<resultMap id="resultPro" type="com.cafe24.smart.approve.domain.Progress">
		<result property="proCode" column="pro_code"/>
		<result property="dftCode" column="dft_code"/>
		<result property="proTime" column="pro_time"/>
		<result property="proReason" column="pro_reason"/>
		<result property="proState" column="pro_state"/>
		<result property="proPersonState" column="pro_personalState"/>
		<result property="proTurn" column="pro_turn"/>
		<result property="proRealTime" column="pro_realTime"/>
		<result property="dftTitle" column="dft_title"/>
		<result property="dftDate" column="dft_date"/>
		<result property="proApproval" column="pro_approval"/>
		<result property="mmCode" column="mm_code"/>
	</resultMap>
		
<!-- 기안 등록 1-1 -->	
<insert id="insertDft" 
		parameterType="com.cafe24.smart.approve.domain.Draft"
		useGeneratedKeys="true" keyProperty="dftCode">

		INSERT INTO draft(
		    apr_code,
		    doc_code,	 
			dft_title,
			dft_degree, 
			mm_code, 
			dft_date,
		    dft_approval1,
		    dft_approval2,
		    dft_approval3,
		    dft_finalState,
		    dft_check,
		   	dft_fileName,
		   	dft_filePath,
		   	dft_fileExtention,
		   	dft_fileOri  
			) 
	    VALUES( 
	 	    #{aprCode},
	 	    #{docCode},
            #{dftTitle},
            #{dftDegree},
            #{mmCode},
	 	    #{dftDate},
		    #{dftApproval1},
		    #{dftApproval2},
	 	    #{dftApproval3},
	 	    #{dftFinalState},
            #{dftCheck},
            #{dftFileName},
            #{dftFilePath},
            #{dftFileExtention},
            #{dftFileOri}
	        )
</insert>

<!-- 진행 등록 1-2 -->
<insert id="insertPg"
		parameterType="com.cafe24.smart.approve.domain.Progress">
		
		INSERT INTO progress(
			pro_time,
			dft_code,
			pro_turn,
			pro_personalState,
			pro_state,
			pro_approval)  
 		VALUES(
 			#{proTime},
	 		#{dftCode},
	 		#{proTurn},
	 		#{proPersonState},
	 		#{proState},
	 		#{proApproval}
	 		) 
</insert>

<!-- 문서 양식 등록 -->
<insert id="insertDoc"
		parameterType="com.cafe24.smart.approve.domain.Document">
		INSERT INTO document(
			doc_fileGroup,
			doc_fileOri,
			doc_fileExtention,
			doc_fileName,
			doc_filePath
			) 
	    VALUES( 
		    #{docFileGroup},
		    #{docFileOri},
		    #{docFileExtention},
		    #{docFileName},
		    #{docFilePath}
			 )
</insert>

<!-- 기안 페이지 요청 -->
<select id="selectAllDoc"
		resultMap="resultDoc">
		SELECT 
			doc_code,
			doc_fileGroup  
		FROM 
			document
</select>

<!-- 결재 목록 :intro 목록(전체 결재 목록)-->
<select id="selectAllPg"
		resultMap="resultDft">
		SELECT 
			* 
		FROM 
			progress,draft 
		WHERE 
			progress.dft_code = draft.dft_code
</select>


<!-- 결재 목록 :결재 대기/반려/완료 -->
<select id="selectByHv"
		parameterType="int"
		resultMap="resultDft">
		SELECT   
			*  
		FROM 
			progress,draft 
		WHERE  
			pro_state = #{proState}
		AND 
			progress.dft_code = draft.dft_code
</select>


<!-- 결재,임시저장 상세보기 : dftCode 가져오기// 결재자 가져오기-->
<select id="selectContHv"
		parameterType="int"
		resultMap="resultDft">
		SELECT 
			*
		FROM
			draft
		WHERE 
			dft_code = #{dftCode}
</select>

<!-- 결재 상세보기 : proApproval 가져오기-->
<select id="selectDetailHv"
		parameterType="int"
		resultMap="resultPro">
		SELECT 
			pro_approval,
			pro_state,
			pro_reason 
		FROM 
			progress 
		WHERE 
			dft_code = #{dftCode}

</select>

<!-- test중중중 -->
<select id="selectNew"
		parameterType="int" 
		resultMap="resultDft">
		select 
			* 
		from 
			draft
		inner join 
		 	document 
		on
			draft.doc_code=document.doc_code
		WHERE 
			dft_code=#{dftCode}
</select>



<!-- 결재 요청 : 1단계 : progress Update -->
<update id="updatePro"
		parameterType="com.cafe24.smart.approve.domain.Progress">
		UPDATE 
			progress 
		SET 
			pro_realTime = #{proRealTime},
			pro_state = #{proState},
			pro_personalstate = #{proPersonState},  
			pro_reason = #{proReason} 
		WHERE 
			dft_code = #{dftCode}

</update>

<!-- 결재 요청 : 2-1단계 : draft update -->
<update id="updateDft"
		parameterType="com.cafe24.smart.approve.domain.Draft">
		UPDATE 
			draft 
		SET 
			dft_degree = #{dftDegree}, 
			dft_finalState = #{dftFinalState}
		WHERE 
			dft_code = #{dftCode};
</update>

<!-- 결재 요청 : 2-2단계 : progress에 결재자 추가//결재 차수 추가 -->
<update id="updateProApv"
	parameterType="com.cafe24.smart.approve.domain.Progress">
		UPDATE 
			progress 
		SET 
			pro_approval = #{proApproval},
			pro_turn = #{proTurn},
			pro_state = #{proState} 
		WHERE 
			dft_code = #{dftCode}
</update>

<!-- 임시 목록 -->
<select id="selectAllTem"
		resultMap="resultDft">
		SELECT 
			* 
		FROM 
			draft
		WHERE 
			dft_check = 'true'
		<!-- 사원코드 select 조건 추가 -->		
</select>
		
		
</mapper>


